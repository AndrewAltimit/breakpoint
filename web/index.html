<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breakpoint</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <canvas id="game-canvas" role="img" aria-label="Game canvas"></canvas>

    <!-- Loading overlay (visible until WASM initializes) -->
    <div id="loading-overlay">
        <div class="loading-content">
            <h1 class="logo">BREAKPOINT</h1>
            <div class="loading-spinner"></div>
            <p class="loading-text">Loading game engine...</p>
        </div>
    </div>

    <!-- Fatal error overlay (WebGL2 failure, WASM load error) -->
    <div id="fatal-error" class="hidden">
        <div class="fatal-error-content">
            <h1 class="logo" style="color: #f77;">BREAKPOINT</h1>
            <p id="fatal-error-msg" class="fatal-error-msg"></p>
            <button class="btn btn-secondary" onclick="location.reload()">Reload Page</button>
        </div>
    </div>

    <noscript>
        <div style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#0d0d1a;color:#e0e0e0;font-family:system-ui;text-align:center;z-index:9999;">
            <div><h1 style="color:#7cf;font-size:2rem;margin-bottom:16px;">BREAKPOINT</h1><p>JavaScript is required to play. Please enable JavaScript and reload.</p></div>
        </div>
    </noscript>

    <div id="ui-root">
        <!-- Lobby Screen -->
        <div id="lobby-screen" class="screen">
            <div class="lobby-container">
                <h1 class="logo">BREAKPOINT</h1>
                <p class="subtitle">Browser-based multiplayer gaming</p>

                <div class="lobby-section">
                    <label for="player-name">Your Name</label>
                    <input type="text" id="player-name" data-testid="player-name" maxlength="20" placeholder="Player123" autocomplete="off">
                </div>

                <div class="lobby-section">
                    <label id="game-selector-label">Select Game</label>
                    <div class="game-selector" data-testid="game-selector" role="group" aria-labelledby="game-selector-label">
                        <button class="game-btn selected" data-testid="game-btn-mini-golf" data-game="mini-golf" aria-pressed="true">Mini Golf</button>
                        <button class="game-btn" data-testid="game-btn-platform-racer" data-game="platform-racer" aria-pressed="false">Platform Racer</button>
                        <button class="game-btn" data-testid="game-btn-laser-tag" data-game="laser-tag" aria-pressed="false">Laser Tag</button>
                        <button class="game-btn" data-testid="game-btn-tron" data-game="tron" aria-pressed="false">Tron</button>
                    </div>
                </div>

                <div id="game-settings" class="lobby-section hidden">
                    <label>Game Settings</label>
                    <div id="settings-platformer" class="game-settings-panel hidden">
                        <div class="setting-row">
                            <span>Mode</span>
                            <select id="setting-platformer-mode" data-testid="setting-platformer-mode">
                                <option value="race">Race</option>
                                <option value="survival">Survival</option>
                            </select>
                        </div>
                    </div>
                    <div id="settings-lasertag" class="game-settings-panel hidden">
                        <div class="setting-row">
                            <span>Team Mode</span>
                            <select id="setting-lasertag-team-mode" data-testid="setting-lasertag-team-mode">
                                <option value="ffa">FFA</option>
                                <option value="2teams">2 Teams</option>
                                <option value="3teams">3 Teams</option>
                                <option value="4teams">4 Teams</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <span>Arena Size</span>
                            <select id="setting-lasertag-arena-size" data-testid="setting-lasertag-arena-size">
                                <option value="small">Small</option>
                                <option value="default" selected>Default</option>
                                <option value="large">Large</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="lobby-actions">
                    <button id="btn-create" data-testid="btn-create" class="btn btn-primary">Create Room</button>
                    <div class="join-row">
                        <input type="text" id="join-code" data-testid="join-code" maxlength="9" placeholder="ABCD-1234" autocomplete="off" aria-label="Room code">
                        <button id="btn-join" data-testid="btn-join" class="btn btn-secondary">Join</button>
                    </div>
                </div>

                <div id="lobby-status" data-testid="lobby-status" class="status-msg" aria-live="polite"></div>
                <div id="lobby-error" data-testid="lobby-error" class="error-msg" role="alert" aria-live="assertive"></div>

                <div id="room-info" data-testid="room-info" class="room-info hidden">
                    <div class="room-code-display">
                        <span>Room Code:</span>
                        <strong id="room-code-value" data-testid="room-code-value"></strong>
                    </div>
                    <div id="player-list" data-testid="player-list" class="player-list"></div>
                    <button id="btn-start" data-testid="btn-start" class="btn btn-primary btn-start hidden">Start Game</button>
                </div>
            </div>
        </div>

        <!-- Game HUD -->
        <div id="game-hud" data-testid="game-hud" class="screen hidden">
            <div class="hud-top">
                <span id="hud-game-name" data-testid="hud-game-name" class="hud-label"></span>
                <span id="hud-round" data-testid="hud-round" class="hud-label"></span>
            </div>
            <div class="hud-bottom">
                <span class="hud-hint" id="hud-controls" data-testid="hud-controls"></span>
            </div>
            <!-- Golf HUD -->
            <div id="golf-hud" class="game-specific-hud hidden">
                <div class="golf-hole-info">
                    <span id="golf-hole-name"></span>
                    <span id="golf-par"></span>
                </div>
                <div id="golf-player-strokes" class="golf-strokes"></div>
            </div>
            <!-- Platformer HUD -->
            <div id="platformer-hud" class="game-specific-hud hidden">
                <div class="platformer-info">
                    <span id="platformer-mode"></span>
                    <span id="platformer-hazard"></span>
                </div>
                <div id="platformer-rankings" class="platformer-rankings"></div>
            </div>
            <!-- LaserTag HUD -->
            <div id="lasertag-hud" class="game-specific-hud hidden">
                <div class="lasertag-info">
                    <span id="lasertag-mode"></span>
                    <span id="lasertag-timer"></span>
                </div>
                <div id="lasertag-scores" class="lasertag-scores"></div>
                <div id="lasertag-stun" class="lasertag-stun hidden">STUNNED</div>
            </div>
            <!-- Tron-specific HUD overlay -->
            <div id="tron-hud-container"></div>
            <canvas id="tron-minimap" width="200" height="200"></canvas>
            <div id="tron-gauges" class="tron-gauges hidden">
                <div class="tron-gauge">
                    <span class="tron-gauge-label">SPD</span>
                    <div class="tron-gauge-bar"><div id="tron-speed-fill" class="tron-gauge-fill speed-fill"></div></div>
                </div>
                <div class="tron-gauge">
                    <span class="tron-gauge-label">RBR</span>
                    <div class="tron-gauge-bar"><div id="tron-rubber-fill" class="tron-gauge-fill rubber-fill"></div></div>
                </div>
                <div class="tron-gauge">
                    <span class="tron-gauge-label">BRK</span>
                    <div class="tron-gauge-bar"><div id="tron-brake-fill" class="tron-gauge-fill brake-fill"></div></div>
                </div>
            </div>
        </div>

        <!-- Between Rounds -->
        <div id="between-rounds" data-testid="between-rounds" class="screen hidden" role="dialog" aria-labelledby="between-rounds-title">
            <div class="modal">
                <h2 id="between-rounds-title">Round Complete</h2>
                <div id="round-scores" data-testid="round-scores" class="score-table"></div>
                <p class="round-info" id="round-info" data-testid="round-info"></p>
                <p class="round-countdown" id="round-countdown" data-testid="round-countdown"></p>
            </div>
        </div>

        <!-- Game Over -->
        <div id="game-over" data-testid="game-over" class="screen hidden" role="dialog" aria-labelledby="game-over-title">
            <div class="modal">
                <h2 id="game-over-title">Game Over</h2>
                <div id="final-scores" data-testid="final-scores" class="score-table"></div>
                <div class="game-over-actions">
                    <button id="btn-play-again" data-testid="btn-play-again" class="btn btn-primary">Play Again</button>
                    <button id="btn-return-lobby" data-testid="btn-return-lobby" class="btn btn-secondary">Return to Lobby</button>
                </div>
                <p class="game-over-countdown" id="game-over-countdown" data-testid="game-over-countdown"></p>
            </div>
        </div>

        <!-- Settings toggle -->
        <button id="btn-mute" data-testid="btn-mute" class="icon-btn mute-btn" title="Toggle Audio" aria-label="Toggle audio">&#x1f50a;</button>

        <!-- Disconnect banner -->
        <div id="disconnect-banner" data-testid="disconnect-banner" class="disconnect-banner hidden" role="alert" aria-live="assertive">
            Connection lost. Reconnecting...
        </div>
    </div>

    <!-- Overlay: ticker + toasts -->
    <div id="overlay-container">
        <div id="ticker-bar" data-testid="ticker-bar" class="ticker-bar hidden" role="status" aria-live="polite">
            <span id="ticker-text" data-testid="ticker-text"></span>
        </div>
        <div id="toast-container" data-testid="toast-container" class="toast-container" aria-live="polite" aria-label="Notifications"></div>
        <button id="btn-dashboard" data-testid="btn-dashboard" class="icon-btn dashboard-btn hidden" title="Dashboard" aria-label="Open dashboard">
            <span id="badge-count" data-testid="badge-count" class="badge hidden">0</span>
            &#x1f4cb;
        </button>
    </div>

    <script src="ui.js"></script>
    <script type="module" src="init.js"></script>
</body>
</html>
